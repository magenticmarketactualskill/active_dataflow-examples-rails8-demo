<style>
  body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; margin: 0; padding: 0; background: #f5f7fa; }
  .container { max-width: 1200px; margin: 0 auto; padding: 40px 20px; }
  .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
  h1 { font-size: 2.5em; margin: 0; color: #1a202c; }
  .btn { display: inline-block; padding: 12px 24px; border-radius: 6px; text-decoration: none; font-weight: 600; transition: all 0.2s; }
  .btn-primary { background: #3182ce; color: white; }
  .btn-primary:hover { background: #2c5aa0; }
  .card { background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 20px; }
  .data-flow-item { border-left: 4px solid #805ad5; padding: 20px; margin-bottom: 15px; background: #f7fafc; border-radius: 4px; }
  .data-flow-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
  .data-flow-name { font-size: 1.5em; font-weight: 600; color: #1a202c; }
  .status-badge { padding: 6px 12px; border-radius: 4px; font-size: 0.9em; font-weight: 600; }
  .status-active { background: #d1fae5; color: #065f46; }
  .status-inactive { background: #fee2e2; color: #991b1b; }
  .data-flow-details { color: #4a5568; margin-top: 10px; }
  .data-flow-actions { margin-top: 15px; }
  .data-flow-actions a, .data-flow-actions button { margin-right: 10px; padding: 8px 16px; font-size: 0.9em; }
  .btn-secondary { background: #6b7280; color: white; border: none; cursor: pointer; }
  .btn-secondary:hover { background: #4b5563; }
  .empty-state { text-align: center; padding: 60px 20px; color: #6b7280; }
</style>

<div class="container">
  <div class="header">
    <h1>⚡ Data Flows</h1>
    <%= link_to "← Back to Home", main_app.root_path, class: "btn btn-primary" %>
  </div>

  <div class="card">
    <% if @data_flows&.any? %>
      <h2 style="margin-bottom: 20px;">Active Data Flows (<%= @data_flows.count %>)</h2>
      
      <% @data_flows.each do |data_flow| %>
        <div class="data-flow-item">
          <div class="data-flow-header">
            <div class="data-flow-name"><%= data_flow.name %></div>
            <span class="status-badge <%= data_flow.status == 'active' ? 'status-active' : 'status-inactive' %>">
              <%= data_flow.status.upcase %>
            </span>
          </div>
          
          <div class="data-flow-details">
            <p><strong>Source:</strong> <%= data_flow.source['model_class'] %> 
              <% if data_flow.source['scope_name'] %>
                (<%= data_flow.source['scope_name'] %>)
              <% end %>
            </p>
            <p><strong>Sink:</strong> <%= data_flow.sink['model_class'] %></p>
            <p><strong>Batch Size:</strong> <%= data_flow.source['batch_size'] || 100 %></p>
            <% if data_flow.last_run_at %>
              <p><strong>Last Run:</strong> <%= data_flow.last_run_at.strftime("%Y-%m-%d %H:%M:%S") %></p>
            <% end %>
            <% if data_flow.last_error %>
              <p style="color: #dc2626;"><strong>Last Error:</strong> <%= data_flow.last_error %></p>
            <% end %>
          </div>
          
          <div class="data-flow-actions">
            <%= link_to "View Details", main_app.active_data_flow_data_flow_path(data_flow), class: "btn btn-primary" %>
            <%= link_to "View Runs", main_app.active_data_flow_data_flow_data_flow_runs_path(data_flow), class: "btn btn-secondary" %>
            <%= button_to data_flow.status == 'active' ? 'Deactivate' : 'Activate', 
                          main_app.toggle_status_active_data_flow_data_flow_path(data_flow), 
                          method: :patch, 
                          class: "btn btn-secondary" %>
          </div>
        </div>
      <% end %>
    <% else %>
      <div class="empty-state">
        <h2>No Data Flows Found</h2>
        <p>No data flows have been registered yet.</p>
        <p style="margin-top: 20px; color: #4a5568;">
          Data flows are defined in code (e.g., app/data_flows/). Once defined, they will appear here.
        </p>
      </div>
    <% end %>
  </div>
</div>
